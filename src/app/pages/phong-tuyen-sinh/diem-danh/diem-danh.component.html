<div class="container-fluid wrapper-container diem-danh-container">
  <div class="w-100 d-flex justify-content-between align-items-center">
    <div class="module-name d-flex align-items-center container-fluid">
      <mat-icon>rule</mat-icon>
      <h1>
        Äiá»ƒm danh
        <span *ngIf="count?.checkedIn"
          >{{ count.checkedIn }}/{{ count.total }}</span
        >
      </h1>
    </div>
    <button mat-icon-button [matMenuTriggerFor]="actionMenu">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #actionMenu="matMenu">
      <button mat-menu-item (click)="onShowDeleteConfirm()">
        <mat-icon>replay</mat-icon> LÃ m má»›i (XÃ³a)
      </button>
      <button mat-menu-item (click)="onShowSyncDataDialog()">
        <mat-icon>sync</mat-icon> Äá»“ng bá»™ dá»¯ liá»‡u
      </button>
      <button mat-menu-item (click)="exportFile()" *ngIf="count?.checkedIn">
        <mat-icon>download</mat-icon> Xuáº¥t file Excel
      </button>
    </mat-menu>
  </div>
  <div class="flex-1 diem-danh-content-wrapper">
    <div class="attendance" id="diemDanhWrapper">
      <div
        class="attendance-control"
        [ngClass]="{
          'sticky-mode': checkInSession.subject && checkInSession.time
        }"
      >
        <mat-expansion-panel class="w-100" [expanded]="!checkInSession.time">
          <mat-expansion-panel-header
            [ngClass]="{ selected: !!checkInSession['subject'] }"
          >
            <mat-panel-title> MÃ´n há»c </mat-panel-title>
            <mat-panel-description>
              {{
                !!checkInSession.subject
                  ? "ÄÃ£ chá»n " + checkInSession.subject
                  : "áº¤n chá»n má»™t mÃ´n há»c cho phiÃªn Ä‘iá»ƒm danh nÃ y"
              }}
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div>
            <mat-grid-list
              [cols]="viewPortMode == 'desktop' ? 3 : 1"
              [gutterSize]="'10px'"
            >
              <mat-grid-tile
                *ngFor="let item of subjectList"
                class="checked-in-setting-wrapper cursor-pointer"
                (click)="onUpdateCheckInSession({ subject: item })"
                [ngClass]="{
                  selected: checkInSession['subject'] == item.id
                }"
              >
                <mat-grid-tile-header>{{ item?.id }}</mat-grid-tile-header>
                <span class="checked-in-setting-data">{{ item?.na }}</span>
              </mat-grid-tile>
              <mat-grid-tile
                class="checked-in-setting-wrapper cursor-pointer"
                (click)="onUpdateCheckInSession({ subject: 'addNew' })"
              >
                <mat-grid-tile-header>ThÃªm má»›i</mat-grid-tile-header>
                <mat-icon
                  [ngStyle]="{
                    fontSize: '50px',
                    height: '50px',
                    width: '50px'
                  }"
                  >add</mat-icon
                >
              </mat-grid-tile>
            </mat-grid-list>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel
          class="w-100"
          [disabled]="!checkInSession.subject"
          [expanded]="checkInSession.subject && !checkInSession.time"
        >
          <mat-expansion-panel-header
            [ngClass]="{ selected: !!checkInSession['time'] }"
          >
            <mat-panel-title> Thá»i gian há»c </mat-panel-title>
            <mat-panel-description>
              {{
                !!checkInSession.time
                  ? "ÄÃ£ chá»n " +
                    (checkInSession.time | date : "dd/MM/YYYY HH:mm:ss")
                  : "áº¤n chá»n thá»i gian báº¯t Ä‘áº§u cho phiÃªn Ä‘iá»ƒm danh nÃ y"
              }}
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div>
            <mat-grid-list
              [cols]="viewPortMode == 'desktop' ? 3 : 1"
              [gutterSize]="'10px'"
            >
              <mat-grid-tile
                *ngFor="let item of checkInTimeList"
                class="checked-in-setting-wrapper cursor-pointer"
                (click)="onUpdateCheckInSession({ time: item })"
                [ngClass]="{ selected: checkInSession['time'] == item }"
              >
                <mat-grid-tile-header>{{ item }}</mat-grid-tile-header>
                <span class="checked-in-setting-data"
                  >NgÃ y {{ item | date : "dd" }} thÃ¡ng
                  {{ item | date : "MM" }} nÄƒm {{ item | date : "YYYY" }}
                  {{ item | date : "HH" }} giá» {{ item | date : "mm" }} phÃºt
                </span>
              </mat-grid-tile>
              <mat-grid-tile
                class="checked-in-setting-wrapper cursor-pointer"
                (click)="onUpdateCheckInSession({ time: 'addNew' })"
              >
                <mat-grid-tile-header>ThÃªm má»›i</mat-grid-tile-header>
                <mat-icon
                  [ngStyle]="{
                    fontSize: '50px',
                    height: '50px',
                    width: '50px'
                  }"
                  >add</mat-icon
                >
              </mat-grid-tile>
            </mat-grid-list>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel
          [disabled]="!checkInSession.subject || !checkInSession.time"
          [expanded]="checkInSession.subject && checkInSession.time"
        >
          <mat-expansion-panel-header>
            <mat-panel-title> QuÃ©t mÃ£ QR </mat-panel-title>
            <mat-panel-description>
              ÄÆ°a mÃ£ QR Ä‘Ã£ Ä‘Æ°á»£c cung cáº¥p Ä‘áº¿n gáº§n camera Ä‘á»ƒ quÃ©t mÃ£ Ä‘iá»ƒm danh
            </mat-panel-description>
          </mat-expansion-panel-header>
          <cp-qr-scanner (qrData)="scanComplete($event)"></cp-qr-scanner>
        </mat-expansion-panel>
      </div>
      <div class="attendance-table">
        <div *ngIf="studentSetingGetting" class="d-flex justify-content-center">
          <mat-spinner></mat-spinner>
        </div>
        <div *ngIf="!studentSetingGetting">
          <table class="w-100" *ngIf="viewPortMode == 'desktop'">
            <thead>
              <tr>
                <th>MÃ£ há»c viÃªn</th>
                <th>Há» vÃ  TÃªn</th>
                <th>NÄƒm sinh</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let item of studentSettings"
                [id]="item.id"
                [ngClass]="{ checkedIn: item.checkedIn > 0 }"
              >
                <td>{{ item?.id }}</td>
                <td>{{ item?.na }}</td>
                <td>{{ item?.bi }}</td>
              </tr>
            </tbody>
          </table>
          <mat-list *ngIf="viewPortMode == 'mobile'">
            <mat-list-item
              *ngFor="let item of studentSettings"
              [ngClass]="{ checkedIn: item.checkedIn > 0 }"
            >
              <span matListItemTitle>{{ item?.na }}</span>
              <span matListItemLine>{{ item?.id }}</span>
              <span matListItemLine>{{ item?.bi }}</span>
              <mat-divider matListItemLine></mat-divider>
            </mat-list-item>
          </mat-list>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #welcomeDialog>
  <div mat-dialog-title>Xin chÃ oğŸ‘‹!</div>
  <mat-dialog-content class="mat-dialog-welcome-attendance">
    <div class="text-center">
      <span class="welcomeIcon">{{ welcomeIcon }}</span>
    </div>
    <div *ngIf="!isDuplicate">
      <h1>{{ journeyUser?.na }} sinh nÄƒm {{ journeyUser?.bi }}</h1>
      <p *ngIf="journeyUser?.id">MÃ£ sá»‘: {{ journeyUser?.id }}</p>
    </div>
    <div *ngIf="isDuplicate">
      <p>
        {{ journeyUser?.na }} sinh nÄƒm {{ journeyUser?.bi }}
        <span *ngIf="journeyUser?.id"> | MÃ£ sá»‘: {{ journeyUser?.id }}</span>
      </p>
      <h1>Báº¡n Ä‘Ã£ Ä‘Æ°á»£c Ä‘iá»ƒm danh rá»“iğŸ‘Œ!</h1>
    </div>
  </mat-dialog-content>
</ng-template>

<ng-template #confirmDeleteDialog>
  <div mat-dialog-title>LÃ m má»›i (XÃ³a)</div>
  <mat-dialog-content class="mat-dialog-welcome-attendance">
    <strong>LÆ¯U Ã:</strong>
    <p>ToÃ n bá»™ dá»¯ liá»‡u sáº½ bá»‹ xÃ³a vÃ  khÃ´ng thá»ƒ nÃ o khÃ´i phá»¥c Ä‘Æ°á»£c</p>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-flat-button [mat-dialog-close]="true">Há»§y</button>
    <button
      mat-flat-button
      [mat-dialog-close]="true"
      [color]="'warn'"
      (click)="confirmDelete()"
    >
      Tiáº¿p tá»¥c
    </button>
  </mat-dialog-actions>
</ng-template>
<ng-template #addNewDialog>
  <div mat-dialog-title>ThÃªm {{ addNew?.type?.name }} má»›i</div>
  <mat-dialog-content>
    <ng-container *ngIf="addNew?.type?.key == 'subject'">
      <mat-form-field>
        <mat-label>MÃ£ {{ addNew?.type?.name }}</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="addNew.key"
          [placeholder]="'Nháº­p mÃ£ ' + addNew?.type?.name"
          [required]="true"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>TÃªn {{ addNew?.type?.name }}</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="addNew.value"
          [placeholder]="'Nháº­p tÃªn ' + addNew?.type?.name"
          [required]="true"
        />
      </mat-form-field>
    </ng-container>
    <ng-container *ngIf="addNew?.type?.key == 'time'">
      <mat-form-field>
        <mat-label>Chá»n ngÃ y</mat-label>
        <input matInput [matDatepicker]="picker" [(ngModel)]="addNew.key" />
        <mat-hint>ngÃ y/thÃ¡ng/nÄƒm</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Chá»n giá»</mat-label>
        <input
          matInput
          [(ngModel)]="addNew.value"
          [ngxMatTimepicker]="pickerA"
          placeholder="14:00 PM"
          [format]="24"
          readonly
        />
        <mat-icon matSuffix (click)="pickerA.open()"> watch_later </mat-icon>
      </mat-form-field>
      <ngx-mat-timepicker #pickerA></ngx-mat-timepicker>
    </ng-container>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-flat-button [mat-dialog-close]="true">Há»§y</button>
    <button
      mat-flat-button
      [mat-dialog-close]="true"
      [disabled]="!addNew?.key || !addNew?.value"
      [color]="'primary'"
      (click)="storeNewSubject()"
    >
      ThÃªm
    </button>
  </mat-dialog-actions>
</ng-template>

<ng-template #syncDataDialog>
  <div mat-dialog-title>Äá»“ng bá»™ dá»¯ liá»‡u</div>
  <mat-dialog-content>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title> HÆ°á»›ng dáº«n Ä‘á»“ng bá»™ </mat-panel-title>
        <mat-panel-description>
          HÃ£y xem hÆ°á»›ng dáº«n thá»±c hiá»‡n náº¿u báº¡n chÆ°a biáº¿t cÃ¡ch lÃ m nhÃ©!
        </mat-panel-description>
      </mat-expansion-panel-header>
      <div>
        <h3>HÆ°á»›ng dáº«n Ä‘á»“ng bá»™ dá»¯ liá»‡u</h3>
        <p>Sau khi áº¥n nÃºt Ä‘á»“ng bá»™ dá»¯ liá»‡u:</p>
        <img
          src="/assets/img/guide/admissionOffice/click-sync-menu.png"
          alt="click-sync-menu"
        />
        <p>
          HÃ£y Ä‘á»£i trong giÃ¢y lÃ¡t Ä‘á»ƒ há»‡ thá»‘ng hoáº¡t Ä‘á»™ng vÃ  táº¡o ra file excel Ä‘á»“ng
          bá»™, quÃ¡ trÃ¬nh nÃ y sáº½ tá»‘n vÃ i giÃ¢y cho Ä‘áº¿n tá»‘i Ä‘a lÃ  1 phÃºt.
        </p>
        <p>
          Sau khi quÃ¡ trÃ¬nh táº¡o file thÃ nh cÃ´ng. Há»™p thoáº¡i yÃªu cáº§u lÆ°u trá»¯ sáº½
          hiá»‡n lÃªn, báº¡n cáº§n lÆ°u file Ä‘Ã£ táº¡o vÃ o thÆ° má»¥c mÃ  ká»¹ thuáº­t viÃªn Ä‘Ã£ chia
          sáº» vá»›i báº¡n. <br />
          ThÆ° má»¥c dÃ¹ng Ä‘á»ƒ Ä‘á»“ng bá»™ thÆ°á»ng cÃ³ dáº¡n nhÆ° áº£nh dÆ°á»›i Ä‘Ã¢y:
        </p>
        <img
          src="/assets/img/guide/admissionOffice/google-drive-folder.png"
          alt="click-sync-menu"
        />
        <p>
          Vá»‹ trÃ­ thÆ°á»ng Ä‘Æ°á»£c chá»n lÃ :
          <code>/CDTTU_SYSTEM/PWA/PHÃ’NG TUYá»‚N SINH/BAN CÃ”NG TÃC SINH VIÃŠN/</code>
          <br />
          áº¤n chá»n file cÃ³ tÃªn gáº§n giá»‘ng vá»›i tÃªn file há»‡ thá»‘ng Ä‘Ã£ táº¡o ra: <br />
          <strong> VÃ­ dá»¥: </strong> Náº¿u há»‡ thá»‘ng táº¡o ra file
          <code>admissionOffice(1).xlsx</code> ThÃ¬ báº¡n chá»n file
          <code>admissionOffice.xlsx</code>
        </p>
        <img
          src="/assets/img/guide/admissionOffice/save.png"
          alt="click-sync-menu"
        />
        <p>
          Má»™t há»™p thoáº¡i yÃªu cáº§u cháº¥p nháº­n lÆ°u file sáº½ hiá»‡n lÃªn. báº¡n chá»n
          <strong>Yes</strong> Ä‘á»ƒ Ä‘á»“ng Ã½.
        </p>
        <img
          src="/assets/img/guide/admissionOffice/confirm.png"
          alt="click-sync-menu"
        />
        <p>
          Sau khi Ä‘á»“ng Ã½ cho viá»‡c Ä‘á»“ng bá»™ file (trong Ä‘iá»u kiá»‡n cÃ³ káº¿t ná»‘i
          máº¡ng), file há»‡ thá»‘ng vá»«a táº¡o ra sáº½ Ä‘á»“ng bá»™ vá»›i file Ä‘Æ°á»£c lÆ°u trÃªn
          Google Drive. Váº­y lÃ  quÃ¡ trÃ¬nh Ä‘á»“ng bá»™ Ä‘Ã£ hoÃ n thÃ nh.
        </p>
        <img
          src="/assets/img/guide/admissionOffice/confirm.png"
          alt="click-sync-menu"
        />
        <p>
          <strong>
            HÃ£y kiá»ƒm tra láº¡i káº¿t quáº£ Ä‘á»“ng bá»™ cá»§a báº¡n trÃªn file Google Drive sau
            vÃ i phÃºt Ä‘á»ƒ dá»‹ch vá»¥ Ä‘á»“ng bá»™ cá»§a Google Drive lÃ m viá»‡c nhÃ©!
          </strong>
        </p>
      </div>
    </mat-expansion-panel>
    <div
      *ngIf="isSyncInProgress"
      class="w-100 h-100 d-flex justify-content-center align-items-center flex-column"
    >
      <mat-spinner></mat-spinner>
      <div class="text-center">
        Há»‡ thá»‘ng Ä‘ang táº¡o file Ä‘á»“ng bá»™ dá»¯ liá»‡u, xin Ä‘á»£i trong giÃ¢y lÃ¡t!
      </div>
    </div>
    <mat-expansion-panel [expanded]="isSyncCheck" [disabled]="true">
      <mat-expansion-panel-header
        >Kiá»ƒm tra láº¡i thao tÃ¡c Ä‘á»“ng bá»™</mat-expansion-panel-header
      >
      <div>
        <h3>HÃ£y kiá»ƒm tra láº¡i thao tÃ¡c Ä‘á»“ng bá»™ báº¡n Ä‘Ã£ lÃ m Ä‘Ãºng hay chÆ°a nhÃ©!</h3>
        <p>
          HÃ£y Ä‘áº£m báº£o ráº±ng báº¡n Ä‘Ã£ lÃ m Ä‘Ãºng nhÆ°
          <strong> hÆ°á»›ng dáº«n Ä‘á»“ng bá»™</strong> phÃ­a trÃªn. HÃ£y áº¥n vÃ o nhá»¯ng thao
          tÃ¡c mÃ  báº¡n Ä‘Ã£ thá»±c hiá»‡n:
        </p>
        <mat-selection-list #confirm>
          <mat-list-option
            >ÄÃ£ lÆ°u file mÃ  há»‡ thá»‘ng táº¡o ra vá»›i tÃªn
            <code>admissionOffice.xlsx</code></mat-list-option
          >
          <mat-list-option
            >ÄÃ£ lÆ°u file mÃ  há»‡ thá»‘ng táº¡o ra táº¡i
            <code
              >/CDTTU/CDTTU/CDU/PHÃ’NG TUYá»‚N SINH/BAN CÃ”NG TÃC SINH VIÃŠN/</code
            ></mat-list-option
          >
        </mat-selection-list>
      </div>
    </mat-expansion-panel>
    <p>
      <strong>LiÃªn há»‡ há»— trá»£: </strong>
      <em>(trong trÆ°á»ng há»£p cÃ³ lá»—i xáº£y ra hoáº·c báº¡n khÃ´ng biáº¿t cÃ¡ch lÃ m)</em>
    </p>
    <ul>
      <li>
        Ká»¹ thuáº­t viÃªn: Nguyá»…n Trung NhÃ¢n
        <ul>
          <li>Zalo: 0973.504.713</li>
          <li>Sá»‘ Ä‘iá»‡n thoáº¡i: 0973.504.713</li>
        </ul>
      </li>
      <li>
        Ká»¹ thuáº­t viÃªn: Äá»— Minh Thá»©c
        <ul>
          <li>Zalo: 0977.225.942</li>
          <li>Sá»‘ Ä‘iá»‡n thoáº¡i: 0977.225.942</li>
        </ul>
      </li>
      <li>
        Ká»¹ thuáº­t viÃªn: Nguyá»…n Quá»‘c Háº£i ÄÄƒng
        <ul>
          <li>Zalo: 093.903.1812</li>
          <li>Sá»‘ Ä‘iá»‡n thoáº¡i: 093.903.1812</li>
        </ul>
      </li>
    </ul>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button
      mat-flat-button
      matDialogClose="true"
      *ngIf="!isSyncCheck"
      [disabled]="isSyncInProgress"
    >
      Há»§y
    </button>
    <button
      mat-flat-button
      [color]="'primary'"
      (click)="syncData()"
      *ngIf="!isSyncCheck"
      [disabled]="isSyncInProgress"
    >
      Äá»“ng bá»™
    </button>
    <button
      mat-flat-button
      [color]="'primary'"
      matDialogClose="true"
      *ngIf="isSyncCheck"
      [disabled]="confirm.selectedOptions.selected.length < 2"
    >
      HoÃ n thÃ nh
    </button>
  </mat-dialog-actions>
</ng-template>
