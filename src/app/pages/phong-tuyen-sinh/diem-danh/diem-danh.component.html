<div class="container-fluid wrapper-container diem-danh-container">
  <div class="w-100 d-flex justify-content-between align-items-center">
    <div class="module-name d-flex align-items-center container-fluid">
      <mat-icon>rule</mat-icon>
      <h1>
        ƒêi·ªÉm danh
        <span *ngIf="count?.checkedIn"
          >{{ count.checkedIn }}/{{ count.total }}</span
        >
      </h1>
    </div>
    <button mat-icon-button [matMenuTriggerFor]="actionMenu">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #actionMenu="matMenu">
      <button mat-menu-item (click)="onShowDeleteConfirm()">
        <mat-icon>replay</mat-icon> L√†m m·ªõi (X√≥a)
      </button>
      <button mat-menu-item (click)="onShowSyncDataDialog()">
        <mat-icon>sync</mat-icon> ƒê·ªìng b·ªô d·ªØ li·ªáu
      </button>
      <button mat-menu-item (click)="exportFile()" *ngIf="count?.checkedIn">
        <mat-icon>download</mat-icon> Xu·∫•t file Excel
      </button>
    </mat-menu>
  </div>
  <div class="flex-1 diem-danh-content-wrapper">
    <div class="attendance" id="diemDanhWrapper">
      <div
        class="attendance-control"
        [ngClass]="{
          'sticky-mode': checkInSession.subject && checkInSession.time
        }"
      >
        <mat-expansion-panel class="w-100" [expanded]="!checkInSession.time">
          <mat-expansion-panel-header
            [ngClass]="{ selected: !!checkInSession['subject'] }"
          >
            <mat-panel-title> M√¥n h·ªçc </mat-panel-title>
            <mat-panel-description>
              {{
                !!checkInSession.subject
                  ? "ƒê√£ ch·ªçn " + checkInSession.subject
                  : "·∫§n ch·ªçn m·ªôt m√¥n h·ªçc cho phi√™n ƒëi·ªÉm danh n√†y"
              }}
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div>
            <mat-grid-list
              [cols]="viewPortMode == 'desktop' ? 3 : 1"
              [gutterSize]="'10px'"
            >
              <mat-grid-tile
                *ngFor="let item of subjectList"
                class="checked-in-setting-wrapper cursor-pointer"
                (click)="onUpdateCheckInSession({ subject: item })"
                [ngClass]="{
                  selected: checkInSession['subject'] == item.id
                }"
              >
                <mat-grid-tile-header>{{ item?.id }}</mat-grid-tile-header>
                <span class="checked-in-setting-data">{{ item?.na }}</span>
              </mat-grid-tile>
              <mat-grid-tile
                class="checked-in-setting-wrapper cursor-pointer"
                (click)="onUpdateCheckInSession({ subject: 'addNew' })"
              >
                <mat-grid-tile-header>Th√™m m·ªõi</mat-grid-tile-header>
                <mat-icon
                  [ngStyle]="{
                    fontSize: '50px',
                    height: '50px',
                    width: '50px'
                  }"
                  >add</mat-icon
                >
              </mat-grid-tile>
            </mat-grid-list>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel
          class="w-100"
          [disabled]="!checkInSession.subject"
          [expanded]="checkInSession.subject && !checkInSession.time"
        >
          <mat-expansion-panel-header
            [ngClass]="{ selected: !!checkInSession['time'] }"
          >
            <mat-panel-title> Th·ªùi gian h·ªçc </mat-panel-title>
            <mat-panel-description>
              {{
                !!checkInSession.time
                  ? "ƒê√£ ch·ªçn " +
                    (checkInSession.time | date : "dd/MM/YYYY HH:mm:ss")
                  : "·∫§n ch·ªçn th·ªùi gian b·∫Øt ƒë·∫ßu cho phi√™n ƒëi·ªÉm danh n√†y"
              }}
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div>
            <mat-grid-list
              [cols]="viewPortMode == 'desktop' ? 3 : 1"
              [gutterSize]="'10px'"
            >
              <mat-grid-tile
                *ngFor="let item of checkInTimeList"
                class="checked-in-setting-wrapper cursor-pointer"
                (click)="onUpdateCheckInSession({ time: item })"
                [ngClass]="{ selected: checkInSession['time'] == item }"
              >
                <mat-grid-tile-header>{{ item }}</mat-grid-tile-header>
                <span class="checked-in-setting-data"
                  >Ng√†y {{ item | date : "dd" }} th√°ng
                  {{ item | date : "MM" }} nƒÉm {{ item | date : "YYYY" }}
                  {{ item | date : "HH" }} gi·ªù {{ item | date : "mm" }} ph√∫t
                </span>
              </mat-grid-tile>
              <mat-grid-tile
                class="checked-in-setting-wrapper cursor-pointer"
                (click)="onUpdateCheckInSession({ time: 'addNew' })"
              >
                <mat-grid-tile-header>Th√™m m·ªõi</mat-grid-tile-header>
                <mat-icon
                  [ngStyle]="{
                    fontSize: '50px',
                    height: '50px',
                    width: '50px'
                  }"
                  >add</mat-icon
                >
              </mat-grid-tile>
            </mat-grid-list>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel
          [disabled]="!checkInSession.subject || !checkInSession.time"
          [expanded]="checkInSession.subject && checkInSession.time"
        >
          <mat-expansion-panel-header>
            <mat-panel-title> Qu√©t m√£ QR </mat-panel-title>
            <mat-panel-description>
              ƒê∆∞a m√£ QR ƒë√£ ƒë∆∞·ª£c cung c·∫•p ƒë·∫øn g·∫ßn camera ƒë·ªÉ qu√©t m√£ ƒëi·ªÉm danh
            </mat-panel-description>
          </mat-expansion-panel-header>
          <cp-qr-scanner (qrData)="scanComplete($event)"></cp-qr-scanner>
        </mat-expansion-panel>
      </div>
      <div class="attendance-table">
        <div *ngIf="studentSetingGetting" class="d-flex justify-content-center">
          <mat-spinner></mat-spinner>
        </div>
        <div *ngIf="!studentSetingGetting">
          <table class="w-100" *ngIf="viewPortMode == 'desktop'">
            <thead>
              <tr>
                <th>M√£ h·ªçc vi√™n</th>
                <th>H·ªç v√† T√™n</th>
                <th>NƒÉm sinh</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let item of studentSettings"
                [id]="item.id"
                [ngClass]="{ checkedIn: item.checkedIn > 0 }"
              >
                <td>{{ item?.id }}</td>
                <td>{{ item?.na }}</td>
                <td>{{ item?.bi }}</td>
              </tr>
            </tbody>
          </table>
          <mat-list *ngIf="viewPortMode == 'mobile'">
            <mat-list-item
              *ngFor="let item of studentSettings"
              [ngClass]="{ checkedIn: item.checkedIn > 0 }"
            >
              <span matListItemTitle>{{ item?.na }}</span>
              <span matListItemLine>{{ item?.id }}</span>
              <span matListItemLine>{{ item?.bi }}</span>
              <mat-divider matListItemLine></mat-divider>
            </mat-list-item>
          </mat-list>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #welcomeDialog>
  <div mat-dialog-title>Xin ch√†oüëã!</div>
  <mat-dialog-content class="mat-dialog-welcome-attendance">
    <div class="text-center">
      <span class="welcomeIcon">{{ welcomeIcon }}</span>
    </div>
    <div *ngIf="!isDuplicate">
      <h1>{{ journeyUser?.na }} sinh nƒÉm {{ journeyUser?.bi }}</h1>
      <p *ngIf="journeyUser?.id">M√£ s·ªë: {{ journeyUser?.id }}</p>
    </div>
    <div *ngIf="isDuplicate">
      <p>
        {{ journeyUser?.na }} sinh nƒÉm {{ journeyUser?.bi }}
        <span *ngIf="journeyUser?.id"> | M√£ s·ªë: {{ journeyUser?.id }}</span>
      </p>
      <h1>B·∫°n ƒë√£ ƒë∆∞·ª£c ƒëi·ªÉm danh r·ªìiüëå!</h1>
    </div>
  </mat-dialog-content>
</ng-template>

<ng-template #confirmDeleteDialog>
  <div mat-dialog-title>L√†m m·ªõi (X√≥a)</div>
  <mat-dialog-content class="mat-dialog-welcome-attendance">
    <strong>L∆ØU √ù:</strong>
    <p>To√†n b·ªô d·ªØ li·ªáu s·∫Ω b·ªã x√≥a v√† kh√¥ng th·ªÉ n√†o kh√¥i ph·ª•c ƒë∆∞·ª£c</p>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-flat-button [mat-dialog-close]="true">H·ªßy</button>
    <button
      mat-flat-button
      [mat-dialog-close]="true"
      [color]="'warn'"
      (click)="confirmDelete()"
    >
      Ti·∫øp t·ª•c
    </button>
  </mat-dialog-actions>
</ng-template>
<ng-template #addNewDialog>
  <div mat-dialog-title>Th√™m {{ addNew?.type?.name }} m·ªõi</div>
  <mat-dialog-content>
    <ng-container *ngIf="addNew?.type?.key == 'subject'">
      <mat-form-field>
        <mat-label>M√£ {{ addNew?.type?.name }}</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="addNew.key"
          [placeholder]="'Nh·∫≠p m√£ ' + addNew?.type?.name"
          [required]="true"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>T√™n {{ addNew?.type?.name }}</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="addNew.value"
          [placeholder]="'Nh·∫≠p t√™n ' + addNew?.type?.name"
          [required]="true"
        />
      </mat-form-field>
    </ng-container>
    <ng-container *ngIf="addNew?.type?.key == 'time'">
      <mat-form-field>
        <mat-label>Ch·ªçn ng√†y</mat-label>
        <input matInput [matDatepicker]="picker" [(ngModel)]="addNew.key" />
        <mat-hint>ng√†y/th√°ng/nƒÉm</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Ch·ªçn gi·ªù</mat-label>
        <input
          matInput
          [(ngModel)]="addNew.value"
          [ngxMatTimepicker]="pickerA"
          placeholder="14:00 PM"
          [format]="24"
          readonly
        />
        <mat-icon matSuffix (click)="pickerA.open()"> watch_later </mat-icon>
      </mat-form-field>
      <ngx-mat-timepicker #pickerA></ngx-mat-timepicker>
    </ng-container>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-flat-button [mat-dialog-close]="true">H·ªßy</button>
    <button
      mat-flat-button
      [mat-dialog-close]="true"
      [disabled]="!addNew?.key || !addNew?.value"
      [color]="'primary'"
      (click)="storeNewSubject()"
    >
      Th√™m
    </button>
  </mat-dialog-actions>
</ng-template>

<ng-template #syncDataDialog>
  <div mat-dialog-title>ƒê·ªìng b·ªô d·ªØ li·ªáu</div>
  <mat-dialog-content>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title> H∆∞·ªõng d·∫´n ƒë·ªìng b·ªô </mat-panel-title>
        <mat-panel-description>
          H√£y xem h∆∞·ªõng d·∫´n th·ª±c hi·ªán n·∫øu b·∫°n ch∆∞a bi·∫øt c√°ch l√†m nh√©!
        </mat-panel-description>
      </mat-expansion-panel-header>
      <div>
        <h3>H∆∞·ªõng d·∫´n ƒë·ªìng b·ªô d·ªØ li·ªáu</h3>
        <p>Sau khi ·∫•n n√∫t ƒë·ªìng b·ªô d·ªØ li·ªáu:</p>
        <img
          src="/assets/img/guide/admissionOffice/click-sync-menu.png"
          alt="click-sync-menu"
        />
        <p>
          H√£y ƒë·ª£i trong gi√¢y l√°t ƒë·ªÉ h·ªá th·ªëng ho·∫°t ƒë·ªông v√† t·∫°o ra file excel ƒë·ªìng
          b·ªô, qu√° tr√¨nh n√†y s·∫Ω t·ªën v√†i gi√¢y cho ƒë·∫øn t·ªëi ƒëa l√† 1 ph√∫t.
        </p>
        <p>
          Sau khi qu√° tr√¨nh t·∫°o file th√†nh c√¥ng. H·ªôp tho·∫°i y√™u c·∫ßu l∆∞u tr·ªØ s·∫Ω
          hi·ªán l√™n, b·∫°n c·∫ßn l∆∞u file ƒë√£ t·∫°o v√†o th∆∞ m·ª•c m√† k·ªπ thu·∫≠t vi√™n ƒë√£ chia
          s·∫ª v·ªõi b·∫°n. <br />
          Th∆∞ m·ª•c d√πng ƒë·ªÉ ƒë·ªìng b·ªô th∆∞·ªùng c√≥ d·∫°n nh∆∞ ·∫£nh d∆∞·ªõi ƒë√¢y:
        </p>
        <img
          src="/assets/img/guide/admissionOffice/google-drive-folder.png"
          alt="click-sync-menu"
        />
        <p>
          V·ªã tr√≠ th∆∞·ªùng ƒë∆∞·ª£c ch·ªçn l√†:
          <code>/CDTTU_SYSTEM/PWA/PH√íNG TUY·ªÇN SINH/BAN C√îNG T√ÅC SINH VI√äN/</code>
          <br />
          ·∫§n ch·ªçn file c√≥ t√™n g·∫ßn gi·ªëng v·ªõi t√™n file h·ªá th·ªëng ƒë√£ t·∫°o ra: <br />
          <strong> V√≠ d·ª•: </strong> N·∫øu h·ªá th·ªëng t·∫°o ra file
          <code>admissionOffice(1).xlsx</code> Th√¨ b·∫°n ch·ªçn file
          <code>admissionOffice.xlsx</code>
        </p>
        <img
          src="/assets/img/guide/admissionOffice/save.png"
          alt="click-sync-menu"
        />
        <p>
          M·ªôt h·ªôp tho·∫°i y√™u c·∫ßu ch·∫•p nh·∫≠n l∆∞u file s·∫Ω hi·ªán l√™n. b·∫°n ch·ªçn
          <strong>Yes</strong> ƒë·ªÉ ƒë·ªìng √Ω.
        </p>
        <img
          src="/assets/img/guide/admissionOffice/confirm.png"
          alt="click-sync-menu"
        />
        <p>
          Sau khi ƒë·ªìng √Ω cho vi·ªác ƒë·ªìng b·ªô file (trong ƒëi·ªÅu ki·ªán c√≥ k·∫øt n·ªëi
          m·∫°ng), file h·ªá th·ªëng v·ª´a t·∫°o ra s·∫Ω ƒë·ªìng b·ªô v·ªõi file ƒë∆∞·ª£c l∆∞u tr√™n
          Google Drive. V·∫≠y l√† qu√° tr√¨nh ƒë·ªìng b·ªô ƒë√£ ho√†n th√†nh.
        </p>
        <img
          src="/assets/img/guide/admissionOffice/confirm.png"
          alt="click-sync-menu"
        />
        <p>
          <strong>
            H√£y ki·ªÉm tra l·∫°i k·∫øt qu·∫£ ƒë·ªìng b·ªô c·ªßa b·∫°n tr√™n file Google Drive sau
            v√†i ph√∫t ƒë·ªÉ d·ªãch v·ª• ƒë·ªìng b·ªô c·ªßa Google Drive l√†m vi·ªác nh√©!
          </strong>
        </p>
      </div>
    </mat-expansion-panel>
    <div
      *ngIf="isSyncInProgress"
      class="w-100 h-100 d-flex justify-content-center align-items-center flex-column"
    >
      <mat-spinner></mat-spinner>
      <div class="text-center">
        H·ªá th·ªëng ƒëang t·∫°o file ƒë·ªìng b·ªô d·ªØ li·ªáu, xin ƒë·ª£i trong gi√¢y l√°t!
      </div>
    </div>
    <mat-expansion-panel [expanded]="isSyncCheck" [disabled]="true">
      <mat-expansion-panel-header
        >Ki·ªÉm tra l·∫°i thao t√°c ƒë·ªìng b·ªô</mat-expansion-panel-header
      >
      <div>
        <h3>H√£y ki·ªÉm tra l·∫°i thao t√°c ƒë·ªìng b·ªô b·∫°n ƒë√£ l√†m ƒë√∫ng hay ch∆∞a nh√©!</h3>
        <p>
          H√£y ƒë·∫£m b·∫£o r·∫±ng b·∫°n ƒë√£ l√†m ƒë√∫ng nh∆∞
          <strong> h∆∞·ªõng d·∫´n ƒë·ªìng b·ªô</strong> ph√≠a tr√™n. H√£y ·∫•n v√†o nh·ªØng thao
          t√°c m√† b·∫°n ƒë√£ th·ª±c hi·ªán:
        </p>
        <mat-selection-list #confirm>
          <mat-list-option
            >ƒê√£ l∆∞u file m√† h·ªá th·ªëng t·∫°o ra v·ªõi t√™n
            <code>admissionOffice.xlsx</code></mat-list-option
          >
          <mat-list-option
            >ƒê√£ l∆∞u file m√† h·ªá th·ªëng t·∫°o ra t·∫°i
            <code
              >/CDTTU/CDTTU/CDU/PH√íNG TUY·ªÇN SINH/BAN C√îNG T√ÅC SINH VI√äN/</code
            ></mat-list-option
          >
        </mat-selection-list>
      </div>
    </mat-expansion-panel>
    <p>
      <strong>Li√™n h·ªá h·ªó tr·ª£: </strong>
      <em>(trong tr∆∞·ªùng h·ª£p c√≥ l·ªói x·∫£y ra ho·∫∑c b·∫°n kh√¥ng bi·∫øt c√°ch l√†m)</em>
    </p>
    <ul>
      <li>
        K·ªπ thu·∫≠t vi√™n: Nguy·ªÖn Trung Nh√¢n
        <ul>
          <li>Zalo: 0973.504.713</li>
          <li>S·ªë ƒëi·ªán tho·∫°i: 0973.504.713</li>
        </ul>
      </li>
      <li>
        K·ªπ thu·∫≠t vi√™n: ƒê·ªó Minh Th·ª©c
        <ul>
          <li>Zalo: 0977.225.942</li>
          <li>S·ªë ƒëi·ªán tho·∫°i: 0977.225.942</li>
        </ul>
      </li>
      <li>
        K·ªπ thu·∫≠t vi√™n: Nguy·ªÖn Qu·ªëc H·∫£i ƒêƒÉng
        <ul>
          <li>Zalo: 093.903.1812</li>
          <li>S·ªë ƒëi·ªán tho·∫°i: 093.903.1812</li>
        </ul>
      </li>
    </ul>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button
      mat-flat-button
      matDialogClose="true"
      *ngIf="!isSyncCheck"
      [disabled]="isSyncInProgress"
    >
      H·ªßy
    </button>
    <button
      mat-flat-button
      [color]="'primary'"
      (click)="syncData()"
      *ngIf="!isSyncCheck"
      [disabled]="isSyncInProgress"
    >
      ƒê·ªìng b·ªô
    </button>
    <button
      mat-flat-button
      [color]="'primary'"
      matDialogClose="true"
      *ngIf="isSyncCheck"
      [disabled]="confirm.selectedOptions.selected.length < 2"
    >
      Ho√†n th√†nh
    </button>
  </mat-dialog-actions>
</ng-template>
